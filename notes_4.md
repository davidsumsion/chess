## Relational Databases
## day one
- 3 days of lecture, next phase next time
- CS 452 all about databases, most of it in 3 days
- MySQL
- Relational Model
- DBMS - databases are implemented by software systems called database management systems
  - scales to large amounts of data
- Embedded vs client/server
  - integrated/imbedded
    - not accessable from anywhere else
  - program, server, db
    - more common
    - this is what we're going to do
- Relations = Tables
  - columns like a spreadsheet, classes
- Tuples = Rows
  - primary key, uniquely identifies the row
  - data
- Schema = all the info
- Relational model
  - table class
  - row object
  - relationship (primary and foreign key) relationship (reference)
- foreign keys in tables are primary keys in other tables
- Join: which book has bob read (member, books_read, book)
  - books_read is many-to-many relationship, primary keys of book and member included in books_read
- one to many genre, one genre for many books
- Keys
  - artificial primary keys (has no meaning outside of database)
  - primary key
    - unique for every row
    - every row has to have one
  - natural keys
    - SSN
      - not everyone has one, just US students, not a good primary key
      - don't want people to look for it, identity theft
      - used to recycle SSN numbers
    - some books say always make an artificial key
      - not always the best thing
      - harder to query your db, less efficient
    - performance problems with db is usually with artificial keys instead of natural keys
    - composit key
      - primary key is a combination of attributes
        - 3 columns that are unique
  - Relationions
    - one to one
      - smash all attributes into one table
      - or primary key of one table becomes the other one
        - if it's optional, person has a SSN, could have a person who doesn't have a SSN, save memory not smashing them
          - better than null in database
    - one to many
      - a book has one genre a genre has many books
      - category has one parent, parent has many sub categories
    - many to many
      - join table, 3 tables
- Modeling a database schema
  - draw a diagram, communicate what DB looks like
    - ERD entity relationship diagram
      - crows feet, hash, optional
    - UML diagram -- not just entity, for other software
      - cardinality 1, 0...*
      - 0, 1 if nul
    - RDBMS Mapping
      - Vertical/Horizontal partitioning are both good for differnt reasons
        - total of accounts
        - empty rows
- SQL
  - create/delete tables
  - insert/update/delete rows
  - query for matching rows
  - Data Types
    - Strings
      - character or CHAR
        - every value is n-length character string
      - character varying or varchar (length specified for max)
        - var wideth of string
      - Bit strings
        - bit -- array of n bits
        - bit varying - up to n bits (give max length)
      - numbers
        - integer and smallint
          - usually 32 64, 8 or 16
        - float, real, double precision
          - may or may not be different
        - numberic(precision, scale) or decimal(precision, scale)
      - Large objects
        - binary large objects (img, sound, video)
        - clob - character large object (text documents)
          - usually just store data in file and store link in DB
          - backups take a long time if you use thses
    - Date
    - time
    - time wit tie zone or TIMETZ
    - TIMESTAMP
    - TIMESTAMP with time zone or TIMESTAMPTZ
  - Create a table
    - not imperative (loops, ifs)
    - calc and algebra, give it everything in a single statement
    - CREATE TABLE name {
    - name dataType not null -- automatic null available 
    - id integer not null primary key auto_increment
    - foreign key(name) references category(id) -- now the db knows, not required but helpful
    - }
    - Foreign key contraints
      - not required
      - enforece tha values used as foreign keys exist in their parent tables
      - disallow deletes of the parent table row when refereced as a foreign key in another table
      - disallows update of parent row that would orphan the foreign keys
      - on update cascade on delete restrict
        - when updating current values will go update other tables with correct info
      - available actions
        - no action
        - restrict 
        - set null
        - set default
        - cascate
  - Drop table book;
    - deletes db
    - drop table if exists book;
      - put these for every table at the top of your file
  - INSERT
    - insert into book
    - (title, author, genre, category_id) values ('the work and the glory', 'gerald lund', 'historical fiction', 3);
  - UPDATE
    - update table
    - set column = value, column = value, ...
    - WHERE condition
  - DELETE
    - DELETE FROM member
    - WHERE id = 3;
    - DELETE FRO bookes_read
    - WHERE member_id = 3;
    - DELETE FROM book; -- deletes all books

Day 2
- query
  - select column, column
  - from table, table
  - where condition
- SELECT meber.name book.title
  FROM member, vooks_read, book
- WEHRE member.id = boos_read.member_id AND
  - book.id = books_read.book_id
    (books read by each member)
- SELECT member.name, book.title
- FROM member
INNER JOIN books_read ON member.id = books_read.member_id
  - INNER JOIN book ON books_read.book_id = book_id
  - WHERE genre = 'NonFiction'
DatabaseTransactions
- BEGIN TRANSACTiON
  - SQL statement1
  - SQL statement2
  - COMMIT TRANSACTION or ROLLBACK TRANSACTION
DatabaseAccess from Java
  - J.sql package if part JDBC
    - load a db driver, automatic (used to be explicit, now automatic)
      - try {
        - Class.forName("org.sqlite.JDBC");
      - } catch (ClassNotFound Exception e) {
        - //error could not load db driver
      - }
      - set of implememnting classes for a db
    - open a database connection
      - import java.sql.*;
      - ...
      - String connectionURL = "jdbc:mysql://localhost:3306/BookClub?" + "user=jerodw&password=myPassword"; (bad idea to specify username/password in code)
      - Connection connection = null;
      - try (Connection c = DriverManager.getConnection(connectionURL)){    //try with resources, don't have to close DB manually -- won't close what it didn't open, don't close a transaction before you commit or rollback your transaction if you don't have try w/ resources
        - connection = c;
        - //start transaction
        - connection.setAutoCommit(false); //statements are autocommited, this is how you start a transaction
        - commit
      - } catch (SQLException ex) {
        - //ERROR
        - rollback
      - }
    - start a transction (if needed)
    - execute quereies and/or updates
      - List<Book> book = new arrList
    - String sql = "select id, title, author, genre, category_id from book";
    - try(PreparedStatment stmt = connection.prepareStatment(sql); -- prepared statments prevent hackers SQL injection use a preparedStatment
      - ResultSt rs = stmt.executeQuery()) {
      - while(rs.next()) {
        - int id = rs.getInt(1); 1 based not 0 based!!
        - String title = rs.getString(2);
        - String author = rs.getString(3);
        - String genre = rs.getString(4);
        - int categoryId = rs.getInt(5);
        - books.add(new Book(id, title, author, genre, categoryId));
      - }
    - } catch (SQLException ex) {
      - //error
    - }
    - commit/rollback the transaction (if needed)
      - in catch 
        if connection!= null
        -   connection.rollback();
    - close the db connection (close in a finally block!!)
    - retreiving auto-increment ids
      - want to put it into the object maybe
        - try(PreparedStatment stmt = connection.prepareStatment(sql, Statement.RETURN_GENERATED_KEYS)){    //try w/ resources again!!
          - if(stmt.executeUpdate() == 1) {
            - try(ResultSet generatedKeys = stmt.getGeneratedKeys()) {
              - generatedKeys.next();
              - int id = generatedKeys.getInt(1); //ID of the insertedbook
              - book.setId(id);
            - }
      - }
- String sql = "update book " + 
  - "set title = ?, author = ?, genre = ?, category_id = ? " +
    - "wehre id = ?";         //dangerous sql injection attack, use substitiution
- stmt.exeduteUpdate() == 1 -- something that effected the db, insert, update & delete!
- JDBC & user permissions
  - make it a maven project
    - server.pom.xml
      - have the dependency thing for groupID com.mysql
- do a .gitIgnore, 
  - readME befoer you can run this create a file with jerodw and mypassword
project
  - create interface DAOs
  - create DB w/ actual tables
  - install MySQL workbench
  - figure out how to write a script to run in MySQL
- have to write JDBC code to create DB if not exists
  - starter code has it, but it won't put tables in it
  - look at petShop example (only has 1 DAO)
  - use password algorithm to hash your password


Debugging
- conditional breakpoint
  - valid java code at that point
- runtocursor
- run
  - view breakpoints
    - you can uncheck breakpoints so that you won't have to go back and set it later
    - You can set a breakpoint when there is an exception thrown, can do all or specefic exceptions
    - specefic breakpoint
      - pass count, stop if i've hit it some number of times
      - disable until hitting another breakpoint



Speed
- if else faster than terinary operator 
- pointer array faster than objects in linked list
- 
